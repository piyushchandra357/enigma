<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- HABIT KANBAN VIEW - Beautiful Cards -->
    <!-- ============================================ -->
    <record id="view_personal_habit_kanban" model="ir.ui.view">
        <field name="name">personal.habit.kanban</field>
        <field name="model">personal.habit</field>
        <field name="arch" type="xml">
            <kanban default_group_by="color_code" class="o_kanban_small_column">
                <field name="id"/>
                <field name="name"/>
                <field name="icon"/>
                <field name="color"/>
                <field name="color_code"/>
                <field name="current_streak"/>
                <field name="longest_streak"/>
                <field name="today_done"/>
                <field name="completion_rate"/>
                <field name="last_done_date"/>
                <field name="frequency_type"/>
                <templates>
                    <t t-name="card">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click o_kanban_record" t-att-data-color="record.color.raw_value">
                            <div class="oe_kanban_content">
                                <!-- Header with Icon and Status -->
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fs-1" t-esc="record.icon.raw_value or 'âœ¨'"/>
                                    <span t-if="record.today_done.raw_value" class="badge bg-success fs-6">âœ… Done</span>
                                    <span t-else="" class="badge bg-secondary fs-6">â¬œ Pending</span>
                                </div>

                                <!-- Habit Name -->
                                <div class="oe_kanban_details">
                                    <strong class="o_kanban_record_title fs-5">
                                        <field name="name"/>
                                    </strong>
                                </div>

                                <!-- Streak Display -->
                                <div class="mt-2 d-flex gap-3">
                                    <div class="text-center">
                                        <div class="fs-4 fw-bold text-warning">
                                            ğŸ”¥                                            <t t-esc="record.current_streak.raw_value"/>
                                        </div>
                                        <small class="text-muted">Current</small>
                                    </div>
                                    <div class="text-center">
                                        <div class="fs-4 fw-bold text-info">
                                            ğŸ†                                            <t t-esc="record.longest_streak.raw_value"/>
                                        </div>
                                        <small class="text-muted">Best</small>
                                    </div>
                                </div>

                                <!-- Completion Rate Progress Bar -->
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small>30-day rate</small>
                                        <small>
                                            <t t-esc="Math.round(record.completion_rate.raw_value)"/>
%</small>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" t-att-style="'width: ' + record.completion_rate.raw_value + '%'" t-att-aria-valuenow="record.completion_rate.raw_value" aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Action Button -->
                                <div class="mt-3 text-center">
                                    <button t-if="!record.today_done.raw_value" name="action_check_today" type="object" class="btn btn-primary btn-sm w-100">
                                        âœ“ Check Today
                                    </button>
                                    <button t-else="" name="action_check_today" type="object" class="btn btn-outline-secondary btn-sm w-100">
                                        â†© Undo Check
                                    </button>
                                </div>

                                <!-- Frequency Badge -->
                                <div class="mt-2 text-center">
                                    <span class="badge bg-light text-dark">
                                        <field name="frequency_type"/>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- HABIT LIST VIEW -->
    <!-- ============================================ -->
    <record id="view_personal_habit_list" model="ir.ui.view">
        <field name="name">personal.habit.list</field>
        <field name="model">personal.habit</field>
        <field name="arch" type="xml">
            <list>
                <field name="icon"/>
                <field name="name"/>
                <field name="frequency_type"/>
                <field name="current_streak" string="ğŸ”¥ Streak"/>
                <field name="longest_streak" string="ğŸ† Best"/>
                <field name="completion_rate" widget="progressbar"/>
                <field name="last_done_date"/>
                <field name="today_done" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- HABIT FORM VIEW - Mobile Optimized -->
    <!-- ============================================ -->
    <record id="view_personal_habit_form" model="ir.ui.view">
        <field name="name">personal.habit.form</field>
        <field name="model">personal.habit</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_check_today" type="object" class="oe_stat_button" icon="fa-check-circle">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Check Today</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" type="action" name="%(action_personal_habit_entry)d" icon="fa-list" context="{'default_habit_id': id, 'search_default_habit_id': id}">
                            <field name="entry_count" widget="statinfo" string="Entries"/>
                        </button>
                    </div>

                    <widget name="web_ribbon" title="Done Today!" bg_color="text-bg-success" invisible="not today_done"/>

                    <div class="oe_title">
                        <h1 class="d-flex">
                            <field name="icon" class="me-2" placeholder="âœ¨"/>
                            <field name="name" placeholder="Habit name..."/>
                        </h1>
                    </div>

                    <group col="1">
                        <group string="âš™ï¸ Settings">
                            <field name="color_code" widget="radio"/>
                            <field name="frequency_type"/>
                            <field name="every_n_days" invisible="frequency_type != 'every_n_days'"/>
                            <field name="custom_days" invisible="frequency_type != 'custom'" placeholder="0,2,4 (Mon, Wed, Fri)"/>
                            <field name="goal"/>
                            <field name="active"/>
                        </group>

                        <group string="ğŸ“Š Statistics">
                            <field name="current_streak" readonly="1"/>
                            <field name="longest_streak" readonly="1"/>
                            <field name="completion_rate" widget="progressbar" readonly="1"/>
                            <field name="last_done_date" readonly="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- HABIT SEARCH VIEW -->
    <!-- ============================================ -->
    <record id="view_personal_habit_search" model="ir.ui.view">
        <field name="name">personal.habit.search</field>
        <field name="model">personal.habit</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="frequency_type"/>
                <filter name="filter_active" string="Active" domain="[('active','=',True)]"/>
                <separator/>
                <filter name="filter_daily" string="Daily" domain="[('frequency_type','=','daily')]"/>
                <filter name="filter_weekdays" string="Weekdays" domain="[('frequency_type','=','weekdays')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_color" string="Color" context="{'group_by':'color_code'}"/>
                    <filter name="group_frequency" string="Frequency" context="{'group_by':'frequency_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- HABIT ACTION -->
    <!-- ============================================ -->
    <record id="action_personal_habit" model="ir.actions.act_window">
        <field name="name">My Habits</field>
        <field name="res_model">personal.habit</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first habit!
            </p>
            <p>
                Track daily habits, build streaks, and become your best self ğŸš€
            </p>
        </field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_personal_habit_action" name="My Habits" parent="menu_personal_habits" action="action_personal_habit" sequence="1" />
</odoo>
